{% extends 'nav_bar.html' %}
{% block content %}

<!DOCTYPE html>
<html>
<head>
    <title>Rate Movie</title>
</head>
<body>
    <h1>Rate Movie</h1>

    {% if messages %}
        {% for message in messages %}
            <div>{{ message }}</div>
        {% endfor %}
    {% endif %}

    {% if all_rated %}
        <h2>Congratulations!</h2>
        <p>You have rated all available movies.</p>

    {% else %}
        <div>
            <h2>{{ movie.title }}</h2>

            <!-- Movie rating statistics -->
            {% if movie.total_ratings > 0 %}
                <div>
                    <p><strong>Average Rating:</strong> {{ movie.average_rating }}/3.0 ({{ movie.total_ratings }} rating{{ movie.total_ratings|pluralize }})</p>
                </div>
            {% else %}
                <div>
                    <p><strong>Average Rating:</strong> No ratings yet</p>
                </div>
            {% endif %}

            <!-- Movie poster -->
            {% if movie.poster_url %}
                <div>
                    <img src="{{ movie.poster_url }}" alt="Poster {{ movie.title }}" width="300">
                </div>
            {% endif %}

            <!-- Movie description -->
            {% if movie.description %}
                <div>
                    <h3>Description:</h3>
                    <p>{{ movie.description }}</p>
                </div>
            {% endif %}

            <!-- YouTube trailer -->
            {% if youtube_embed_url %}
                <div>
                    <h3>Trailer:</h3>
                    <iframe width="560" height="315"
                            src="{{ youtube_embed_url }}"
                            frameborder="0"
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                            allowfullscreen>
                    </iframe>
                </div>
            {% elif movie.trailer_url %}
                <div>
                    <h3>Trailer:</h3>
                    <a href="{{ movie.trailer_url }}" target="_blank">Watch trailer</a>
                </div>
            {% endif %}

            <!-- Rating buttons -->
            <div>
                <h3>Rate this movie:</h3>
                <form method="post">
                    {% csrf_token %}

                    <button type="submit" name="rating" value="0">
                        üëé Don't like it
                    </button>

                    <button type="submit" name="rating" value="1">
                        üëç Like it
                    </button>

                    <button type="submit" name="rating" value="2">
                        ‚ù§Ô∏è Love it
                    </button>

                    <button type="submit" name="rating" value="3">
                        ‚úÖ Already watched
                    </button>
                </form>
            </div>
        </div>
    {% endif %}

</body>
</html>
{% endblock %}